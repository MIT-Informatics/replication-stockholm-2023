---
title: "altman-demetrio-tarasenko Stockholm 2023 replication"
format: html
editor: visual
bibliography: references.bib
---

# **A comment on Cavaillé and Ferwerda (2022)**

Micah Altman[^1][^2] (MIT) [escience\@mit.edu](mailto:escience@mit.edu){.email}, Hans Gaebler (Harvard) [jgaebler\@fas.harvard.edu](mailto:jgaebler@fas.harvard.edu){.email}, Georgy Tarasenko (Cornell) [gt298\@cornell.edu](mailto:gt298@cornell.edu){.email}

[^1]: Corresponding author.

[^2]: All authors declare that they have no financial support or conflict of interest in this publication.

## Abstract

**Instructions**:

Cavaillé and Ferwerda (2022) examine the effect of granting immigrants access to the welfare state in Austria during 2006 on the support for far-right parties. In their preferred specification, they find that -- [***magnitude and uncertainty of main effect (p-value)***]{.underline} **--**= supporting the main substantive claim that increasing welfare benefits to immigrants increases support for far-right parties. Moderating this, based on a subset of data from Vienna, they find that -- [***magnitude and uncertainty of secondary effect (p-value)***]{.underline} *--* support was concentrated in districts with a high proportion of public housing beneficiaries or low-end rentals.

First, we reproduce the paper's main and secondary analysis, and find that ...

Second, we test the robustness of the conclusions to (1)... (2)...

We find that ...

## Introduction

```{r setup}
#| include: false
#| echo: false

library(tidyverse)
library(magrittr,include.only="%<>%")
library(broom)
library(gt)

tidy_results<-function(resls){
  purrr::map(resls, \(x) tidy(x)) %>%
    list_rbind(names_to="repl_id")
}

tidy_summary<-function(resls){
  purrr::map(resls, \(x) glance(summary(x))) %>%
    list_rbind(names_to="repl_id")
}

# workaround absence of tidier for some of the packages used
glance.summary.lm_robust <- function(x,...) {
 x[c("r.squared","adj.r.squared","df.residual","res_var","nobs")] %>% as_tibble()
}

glance.summary.glm <- function(x,...) {
 x[c("aic","df.residual")] %>% as_tibble()
}

```

*Briefly describe the main data sources, method, policy or treatment, time period and population for which the estimates apply. Then describe the main scientific claims (descriptive or causal) and robustness checks if those that are relevant for your re-analysis or replication. Quote the original part of the study that has the main scientific claim(s) including page number(s). As suggested in the Guide for Accelerating Computational Reproducibility in the Social Sciences (<https://bitss.github.io/ACRE/>), structure your summary of the main findings and methodology as follows: "The paper tested the effect of X on Y for population P, using method M. The main results show an effect of magnitude E (specify units and standard errors)" or "The paper estimated the value of Y (estimated or predicted) for population P under dimensions X using method M. The main results presented an estimate of magnitude E (specify units and standard errors)". This template assumes that the paper's scientific claims are focused on estimating a causal relationship. In the event that the original study is estimating/predicting a descriptive statistic of a population, or something else, then describe and quote the results accordingly using precise claims from the original study.*

*\_ Next, summarize your reproduction and/or replication. Start by stating how you have obtained the data and codes and if the original author(s) answered your request(s) a/nd questions. Indicate the repository where your programs and data are located. Then proceed with a description of your [conceptual reproducibility](https://i4replication.org/definitions.html) by describing if you have found coding error(s) and how they affect the main conclusions.\_*

*\_ For replication, we adopt the definitions [here](https://i4replication.org/definitions.html). For robustness replicability, clearly state your robustness checks and how they affect the main point estimates. For direct and conceptual replications, clearly describe the new data. For conceptual replications, also describe the new procedures or they differ from the original study. Different procedures implies a different experimental design and/or analysis for experiments and different methods and/or analysis for observational data.\_*

*For all three replication types, be precise and summarize your results as follows: "Implementing this robustness increases/decreases the size of the main point estimate for outcome Y by X and the estimate is not anymore statistically significant at the X% level" or "Implementing this robustness check has no effect on the magnitude or the statistical significance of the main point estimate." Also report the coefficient (or other effect size), the standard error of the coefficient/effect size, the test statistic including df if relevant, and the p-value for all tests.*

## Reproducibility

Simple Direct Reproduction (Calibration)

### Reproduction of Table 1 - Model 1 (Primary Result)

```{r main-result-reproduction}
#| echo: false

requireNamespace("haven")
requireNamespace("estimatr")

# main replication data from authors
austria_authors.df <-
  haven::read_dta("authors replication materials/Austria_final.dta")

# verbatim results from published article for main model
# NOTE: p-value represents upper bound of actual p-value, since only a '*' notation used in reporting

tidy_m1_original.df <-
  structure(
    list(
      term = c(
        "(Intercept)",
        "dv_pop_01",
        "pct_noneu_06",
        "dv_pop_01:pct_noneu_06"
      ),
      estimate = c(0.04, 0.02,-0.02, 0.67),
      std.error = c(0, 0.03, 0.03, 0.17),
      p.value = c(0.05, 1,  0.05, 0.05),
      repl_id = c("original", "original", "original",  "original")
    ),
    row.names = c(NA,-4L),
    class = "data.frame"
  )

# reproduce authors model using original code for OLS with 'robust' errors'

m1.formula  <- formula("d_rr_06 ~ dv_pop_01*pct_noneu_06")

results_m1_computational.lmr <-
  estimatr::lm_robust(m1.formula,   data = austria_authors.df)

repro_m1.df <- tidy_results(list(comp=results_m1_computational.lmr)) %>% 
   bind_rows(tidy_m1_original.df)

repro_m1_summary.df <- tidy_summary(list(comp=results_m1_computational.lmr))

repro_m1.df %>% group_by(repl_id) %>% gt()

repro_m1_summary.df %>% group_by(repl_id) %>% gt()
```

### Reproduction of Table 2 - Model 1 (Secondary Result)

```{r secondary-result-reproduction}
vienna_authors.df <- 
  haven::read_dta("authors replication materials/vienna_final.dta")

m2.formula<- formula("dv ~  (pctrental + pctpublic_w_zsp)")

results_m2_computational.lmr <-
  estimatr::lm_robust(m2.formula,   data = vienna_authors.df, 
                      clusters = tract_key)

tidy_m2_original.df <-
  structure(
    list(
      term = c(
        "(Intercept)",
        "pctrental",
        "pctpublic_w_zsp"
      ),
      estimate = c(0.04, 0.03,-0.09),
      std.error = c(0.01, 0.01, 0.01),
      p.value = c(0.05, 0.05,  0.05),
      repl_id = c("original", "original", "original")
    ),
    row.names = c(NA,-3L),
    class = "data.frame"
  )

repro_m2.df <- tidy_results(list(comp=results_m2_computational.lmr)) %>% 
   bind_rows(tidy_m2_original.df)

repro_m2_summary.df <- tidy_summary(list(comp=results_m2_computational.lmr))

repro_m2.df %>% group_by(repl_id) %>% gt()

repro_m2_summary.df %>% group_by(repl_id) %>% gt()
```

### Summary - Direct Reproducibility

-   Main result - reproducible with original data & code

-   Secondary result - reproducible with original data & code

-   Comments: specific p-values, measures of fit, cluster variable missingness

    -   Appendix does provide some additional detail on number of observations -- though not for models in table & 2 -- provides no additional measures of fit, or precision on p-values

### Alternate Estimation Procedures (computational robustness)

Generally, even with a fixed statistical model family and specification results may vary with the estimation algorithm used and specific software's implementation of it. [@altman2004] We evaluate the computational robustness of the model by using alternative algorithms and implementations.

#### Primary Result

```{r alternate-estimations-m1}
requireNamespace("arm")

results_m1_statlm.lm <-
  stats::lm(m1.formula, data = austria_authors.df)
results_m1_statglm.glm <-
  stats::glm(m1.formula, data = austria_authors.df)
results_m1_statbayeslm.glm <-
  arm::bayesglm(m1.formula, data = austria_authors.df, 
                prior.scale=Inf, prior.df=Inf)

#Note: could also add nls, bayesglm, mle2 -- would require re-expressing current formula in different syntax, and renaming results matrix

ml.ls <- list(lmrobust = results_m1_computational.lmr,
              lm=results_m1_statlm.lm,
              glm=results_m1_statglm.glm,
              bayes=results_m1_statbayeslm.glm)

alt_est_m1.df <- tidy_results(ml.ls)
alt_est_m1_summary.df <- tidy_summary(ml.ls)

alt_est_m1.df  %>% group_by(repl_id) %>% gt()
alt_est_m1_summary.df %>% group_by(repl_id) %>% gt()

rm(ml.ls,results_m1_statlm.lm,results_m1_statglm.glm,results_m1_statbayeslm.glm)
```

#### Secondary Result

```{r alternate-estimations-m2}

requireNamespace("arm")

results_m2_statlm.lm <-
  stats::lm(m2.formula, data = vienna_authors.df)
results_m2_statglm.glm <-
  stats::glm(m2.formula, data = vienna_authors.df)
results_m2_statbayeslm.glm <-
  arm::bayesglm(m2.formula, data = vienna_authors.df, 
                prior.scale=Inf, prior.df=Inf)

#Note: could also add nls, bayesglm, mle2 -- would require re-expressing current formula in different syntax, and renaming results matrix

ml.ls <- list(lmrobust = results_m1_computational.lmr,
              lm=results_m2_statlm.lm,
              glm=results_m2_statglm.glm,
              bayes=results_m2_statbayeslm.glm)

alt_est_m2.df <- tidy_results(ml.ls)
alt_est_m2_summary.df <- tidy_summary(ml.ls)

alt_est_m2.df  %>% group_by(repl_id) %>% gt()
alt_est_m2_summary.df %>% group_by(repl_id) %>% gt()
rm(ml.ls,results_m2_statlm.lm,results_m2_statglm.glm,results_m2_statbayeslm.glm)
```

## Replication:

*Clearly state/describe which type of replication you are conducting. See definitions at the beginning of this document. For robustness replicability, present your robustness checks and how they impact the main point estimates one by one so that it is clear how each modification to the specification/analysis impacts the main conclusions. Then you may combine them. Also, clearly state why you conduct each specific robustness check and/or modify the setting/model.*

### Alternate OLS Specification (covariate robustness)

```{r alternate-variables-m1}
results_m1_nomain.lmr <-
  estimatr::lm_robust(formula("d_rr_06 ~ dv_pop_01:pct_noneu_06 -dv_pop_01 -pct_noneu_06"), data = austria_authors.df)


results_m1_kitchensink.lmr <-
  estimatr::lm_robust(formula("d_rr_06 ~ dv_pop_01:pct_noneu_06 +educ_tertiary +avg_income +lab_pct_manufact_01 +lab_pct_unemp +welfare_cap_06 +health_cap_06 +education_cap_06 +foreignborn_delta+citizen_eu_growth_pct +vacancy_01_public"), data = austria_authors.df)

results_m1_mainonly.lmr <-
  estimatr::lm_robust(formula("d_rr_06 ~ dv_pop_01 + pct_noneu_06 "), data = austria_authors.df)



alt_var_m1.df <- tidy_results(list(nomain = results_m1_nomain.lmr,
                                   kitchen =results_m1_kitchensink.lmr,
                                   mainonly =results_m1_mainonly.lmr))

alt_var_m1_summary.df <- tidy_summary(list(nomain = results_m1_nomain.lmr,
                                   kitchen =results_m1_kitchensink.lmr,
                                   mainonly =results_m1_mainonly.lmr))

alt_var_m1.df  %>% group_by(repl_id) %>% gt()
alt_var_m1_summary.df %>% group_by(repl_id) %>% gt()


```

-   alternate methods for computing robust standard errors? (e.g. sensemaker, lmtest, sandwich)

### Alternate data (data robustness)

-   intraoccular impact

-   outlier analysis

-   residual analysis

-   perturbation analysis

-   subsampling analysis

```{r alternate-data}

austria_authors.df %>% ggplot(aes(y=d_rr_06)) + geom_histogram(bins=100)
```

### Alternate Models (model and alternate hypothesis robustness)

-   specific alternate models ?

-   general model comparison and synthesis -- (e.g. bayesian model averaging)

```{r alternate-models}

```

### Summary - Replicability

## Conclusion

*State the most important results of your work and what you have learned. You may also describe other empirical exercises that could be conducted by other replicators.*

## References

Cavaille, Charlotte, and Jeremy Ferwerda. "How distributional conflict over in-kind benefits generates support for far-right parties." The Journal of Politics 85, no. 1 (2023): 19-33.
